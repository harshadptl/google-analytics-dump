/*
analytics-dump - v - 2013-11-02
Dumps analytics from google into a csv
Lovingly coded by Jess Frazelle  - http://frazelledazzell.com/ 
*/
function handleClientLoad(){gapi.client.setApiKey(apiKey),window.setTimeout(checkAuth,1)}function checkAuth(){gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:!0},handleAuthResult)}function handleAuthResult(a){a?gapi.client.load("analytics","v3",handleAuthorized):handleUnauthorized()}function handleAuthorized(){var a=document.getElementById("authorize-button"),b=document.getElementById("make-api-call-button");a.style.visibility="hidden",b.style.visibility="visible",b.onclick=makeApiCall,outputToPage("Click the Run Demo button to begin.")}function handleUnauthorized(){var a=document.getElementById("authorize-button"),b=document.getElementById("make-api-call-button");b.style.visibility="hidden",a.style.visibility="visible",a.onclick=handleAuthClick,outputToPage("Please authorize this script to access Google Analytics.")}function handleAuthClick(){return gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:!1},handleAuthResult),!1}function makeApiCall(){outputToPage("Querying Accounts."),gapi.client.analytics.management.accounts.list().execute(handleAccounts)}function handleAccounts(a){if(a.code)updatePage("There was an error querying accounts: "+a.message);else if(a&&a.items&&a.items.length){var b=a.items[0].id;queryWebproperties(b)}else updatePage("No accounts found for this user.")}function queryWebproperties(a){updatePage("Querying Webproperties."),gapi.client.analytics.management.webproperties.list({accountId:a}).execute(handleWebproperties)}function handleWebproperties(a){if(a.code)updatePage("There was an error querying webproperties: "+a.message);else if(a&&a.items&&a.items.length){var b=a.items[0].accountId,c=a.items[0].id;queryProfiles(b,c)}else updatePage("No webproperties found for this user.")}function queryProfiles(a,b){updatePage("Querying Profiles."),gapi.client.analytics.management.profiles.list({accountId:a,webPropertyId:b}).execute(handleProfiles)}function handleProfiles(a){if(a.code)updatePage("There was an error querying profiles: "+a.message);else if(a&&a.items&&a.items.length){var b=a.items[0].id;queryCoreReportingApi(b)}else updatePage("No profiles found for this user.")}function queryCoreReportingApi(a){updatePage("Querying Core Reporting API."),gapi.client.analytics.data.ga.get({ids:"ga:"+a,"start-date":lastNDays(14),"end-date":lastNDays(0),metrics:"ga:visits",dimensions:"ga:source,ga:keyword",sort:"-ga:visits,ga:source",filters:"ga:medium==organic","max-results":25}).execute(handleCoreReportingResults)}function handleCoreReportingResults(a){if(a.code)updatePage("There was an error querying core reporting API: "+a.message);else if(a.rows&&a.rows.length){var b=[];b.push("Profile Name: ",a.profileInfo.profileName,"<br>");var c=["<table>"];c.push("<tr>");for(var d,e=0;d=a.columnHeaders[e];++e)c.push("<th>",d.name,"</th>");c.push("</tr>");for(var f,e=0;f=a.rows[e];++e)c.push("<tr><td>",f.join("</td><td>"),"</td></tr>");c.push("</table>"),b.push(c.join("")),outputToPage(b.join(""))}else outputToPage("No results found.")}function outputToPage(a){document.getElementById("output").innerHTML=a}function updatePage(a){document.getElementById("output").innerHTML+="<br>"+a}function lastNDays(a){var b=new Date,c=new Date;c.setDate(b.getDate()-a);var d=c.getFullYear(),e=c.getMonth()+1;10>e&&(e="0"+e);var f=c.getDate();return 10>f&&(f="0"+f),[d,e,f].join("-")}var clientId="1008856934158.apps.googleusercontent.com",apiKey="AIzaSyC9IVFnVPB5_1X7uUXq90UvJUYeJSHmNiU",scopes="https://www.googleapis.com/auth/analytics.readonly";